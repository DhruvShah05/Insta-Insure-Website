{% extends "base.html" %}

{% block title %}Pending Policies - Insta Insurances Portal{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-6);
    }

    .page-title {
        font-size: var(--font-size-2xl);
        font-weight: 700;
        color: var(--gray-900);
        margin: 0;
    }

    .table-container {
        background: var(--white);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--gray-200);
        overflow: hidden;
    }

    .table-responsive {
        overflow-x: auto;
    }

    .table {
        margin-bottom: 0;
        min-width: 1000px;
    }

    .table th {
        background: var(--gray-50);
        border-bottom: 2px solid var(--gray-200);
        font-weight: 600;
        color: var(--gray-900);
        padding: var(--spacing-4);
    }

    .table td {
        padding: var(--spacing-4);
        border-bottom: 1px solid var(--gray-100);
        vertical-align: middle;
    }

    .table tbody tr:hover {
        background: var(--gray-25);
    }

    .customer-info {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-1);
    }

    .customer-name {
        font-weight: 500;
        color: var(--gray-900);
    }

    .customer-contact {
        font-size: var(--font-size-xs);
        color: var(--gray-500);
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        padding: var(--spacing-1) var(--spacing-2);
        border-radius: var(--radius-sm);
        font-size: var(--font-size-xs);
        font-weight: 500;
        background: var(--warning-light);
        color: #92400e;
    }

    .action-buttons {
        display: flex;
        gap: var(--spacing-2);
        flex-wrap: wrap;
    }

    @media (max-width: 768px) {
        .page-header {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--spacing-4);
        }

        .action-buttons {
            flex-direction: column;
            width: 100%;
        }

        .action-buttons .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Pending Policies</h1>
    <a href="{{ url_for('pending_policies.add_pending') }}" class="btn btn-primary">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-2">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
        Add Pending Policy
    </a>
</div>

<div class="table-container">
    {% if pending_policies %}
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Pending ID</th>
                    <th>Customer</th>
                    <th>Insurance Company</th>
                    <th>Product</th>
                    <th>Premium</th>
                    <th>Status</th>
                    <th>Created Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for pending in pending_policies %}
                <tr>
                    <td><strong>#{{ pending.pending_id }}</strong></td>
                    <td>
                        <div class="customer-info">
                            <div class="customer-name">{{ pending.customer_name or 'Unknown' }}</div>
                            {% if pending.customer_phone %}
                            <div class="customer-contact">{{ pending.customer_phone }}</div>
                            {% endif %}
                        </div>
                    </td>
                    <td>{{ pending.insurance_company }}</td>
                    <td>{{ pending.product_name }}</td>
                    <td>
                        {% if pending.gross_premium %}
                            â‚¹{{ "{:,.2f}".format(pending.gross_premium) }}
                        {% else %}
                            <span class="text-muted">Not specified</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="status-badge">Pending Payment</span>
                    </td>
                    <td>{{ pending.created_at[:10] | indian_date if pending.created_at else 'N/A' }}</td>
                    <td>
                        <div class="action-buttons">
                            <a href="{{ url_for('pending_policies.complete_pending', pending_id=pending.pending_id) }}" 
                               class="btn btn-sm btn-success">Complete</a>
                            <form method="POST" action="{{ url_for('pending_policies.delete_pending', pending_id=pending.pending_id) }}" 
                                  style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this pending policy?')">
                                <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        <h5>No pending policies</h5>
        <p>All policies have been processed or no pending policies have been added yet.</p>
        <a href="{{ url_for('pending_policies.add_pending') }}" class="btn btn-primary mt-3">Add Pending Policy</a>
    </div>
    {% endif %}
</div>
{% endblock %}
